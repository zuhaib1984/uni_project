/*!
 * @license
 * chartjs-chart-financial
 * http://chartjs.org/
 * Version: 0.1.0
 *
 * Copyright 2023 Chart.js Contributors
 * Released under the MIT license
 * https://github.com/chartjs/chartjs-chart-financial/blob/master/LICENSE.md
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("chart.js"),require("chart.js/helpers")):"function"==typeof define&&define.amd?define(["chart.js","chart.js/helpers"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Chart,e.Chart.helpers)}(this,(function(e,t){"use strict";class l extends e.BarController{getLabelAndValue(e){const t=this,l=t.getParsed(e),a=t._cachedMeta.iScale.axis,{o:o,h:n,l:r,c:i}=l,s=`O: ${o}  H: ${n}  L: ${r}  C: ${i}`;return{label:`${t._cachedMeta.iScale.getLabelForValue(l[a])}`,value:s}}getAllParsedValues(){const e=this._cachedMeta,t=e.iScale.axis,l=e._parsed,a=[];for(let e=0;e<l.length;++e)a.push(l[e][t]);return a}getMinMax(e){const t=this._cachedMeta,l=t._parsed,a=t.iScale.axis;if(l.length<2)return{min:0,max:1};if(e===t.iScale)return{min:l[0][a],max:l[l.length-1][a]};let o=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY;for(let e=0;e<l.length;e++){const t=l[e];o=Math.min(o,t.l),n=Math.max(n,t.h)}return{min:o,max:n}}_getRuler(){const e=this,t=e.options,l=e._cachedMeta,a=l.iScale,o=a.axis,n=[];for(let t=0;t<l.data.length;++t)n.push(a.getPixelForValue(e.getParsed(t)[o]));const r=t.barThickness,i=function(e,t){let l,a,o,n,r=e._length;for(o=1,n=t.length;o<n;++o)r=Math.min(r,Math.abs(t[o]-t[o-1]));for(o=0,n=e.ticks.length;o<n;++o)a=e.getPixelForTick(o),r=o>0?Math.min(r,Math.abs(a-l)):r,l=a;return r}(a,n);return{min:i,pixels:n,start:a._startPixel,end:a._endPixel,stackCount:e._getStackCount(),scale:a,ratio:r?1:t.categoryPercentage*t.barPercentage}}calculateElementProperties(e,t,l,a){const o=this,n=o._cachedMeta.vScale,r=n.getBasePixel(),i=o._calculateBarIndexPixels(e,t,a),s=o.chart.data.datasets[o.index].data[e],c=n.getPixelForValue(s.o),d=n.getPixelForValue(s.h),h=n.getPixelForValue(s.l),u=n.getPixelForValue(s.c);return{base:l?r:h,x:i.center,y:(h+d)/2,width:i.size,open:c,high:d,low:h,close:u}}draw(){const e=this,l=e.chart,a=e._cachedMeta.data;t.clipArea(l.ctx,l.chartArea);for(let t=0;t<a.length;++t)a[t].draw(e._ctx);t.unclipArea(l.ctx)}}l.overrides={label:"",parsing:!1,hover:{mode:"label"},datasets:{categoryPercentage:.8,barPercentage:.9,animation:{numbers:{type:"number",properties:["x","y","base","width","open","high","low","close"]}}},scales:{x:{type:"timeseries",offset:!0,ticks:{major:{enabled:!0},fontStyle:e=>e.tick.major?"bold":void 0,source:"data",maxRotation:0,autoSkip:!0,autoSkipPadding:75,sampleSize:100},afterBuildTicks:e=>{const t=window&&window.luxon&&window.luxon.DateTime;if(!t)return;const l=e._majorUnit,a=e.ticks,o=a[0];if(!o)return;let n=t.fromMillis(o.value);"minute"===l&&0===n.second||"hour"===l&&0===n.minute||"day"===l&&9===n.hour||"month"===l&&n.day<=3&&1===n.weekday||"year"===l&&1===n.month?o.major=!0:o.major=!1;let r=n.get(l);for(let e=1;e<a.length;e++){const o=a[e];n=t.fromMillis(o.value);const i=n.get(l);o.major=i!==r,r=i}e.ticks=a}},y:{type:"linear"}},plugins:{tooltip:{intersect:!1,mode:"index",callbacks:{label(l){const a=l.parsed;if(!t.isNullOrUndef(a.y))return e.defaults.plugins.tooltip.callbacks.label(l);const{o:o,h:n,l:r,c:i}=a;return`O: ${o}  H: ${n}  L: ${r}  C: ${i}`}}}}};function a(e,t,l,a){const o=null===t,n=null===l,r=!(!e||o&&n)&&function(e,t){const{x:l,y:a,base:o,width:n,height:r}=e.getProps(["x","low","high","width","height"],t);let i,s,c,d,h;return e.horizontal?(h=r/2,i=Math.min(l,o),s=Math.max(l,o),c=a-h,d=a+h):(h=n/2,i=l-h,s=l+h,c=Math.min(a,o),d=Math.max(a,o)),{left:i,top:c,right:s,bottom:d}}(e,a);return r&&(o||t>=r.left&&t<=r.right)&&(n||l>=r.top&&l<=r.bottom)}e.Chart.defaults.elements.financial={color:{up:"rgba(80, 160, 115, 1)",down:"rgba(215, 85, 65, 1)",unchanged:"rgba(90, 90, 90, 1)"}};class o extends e.Element{height(){return this.base-this.y}inRange(e,t,l){return a(this,e,t,l)}inXRange(e,t){return a(this,e,null,t)}inYRange(e,t){return a(this,null,e,t)}getRange(e){return"x"===e?this.width/2:this.height/2}getCenterPoint(e){const{x:t,low:l,high:a}=this.getProps(["x","low","high"],e);return{x:t,y:(a+l)/2}}tooltipPosition(e){const{x:t,open:l,close:a}=this.getProps(["x","open","close"],e);return{x:t,y:(l+a)/2}}}const n=e.Chart.defaults;class r extends o{draw(e){const l=this,{x:a,open:o,high:r,low:i,close:s}=l;let c,d=l.borderColor;"string"==typeof d&&(d={up:d,down:d,unchanged:d}),s<o?(c=t.valueOrDefault(d?d.up:void 0,n.elements.candlestick.borderColor),e.fillStyle=t.valueOrDefault(l.color?l.color.up:void 0,n.elements.candlestick.color.up)):s>o?(c=t.valueOrDefault(d?d.down:void 0,n.elements.candlestick.borderColor),e.fillStyle=t.valueOrDefault(l.color?l.color.down:void 0,n.elements.candlestick.color.down)):(c=t.valueOrDefault(d?d.unchanged:void 0,n.elements.candlestick.borderColor),e.fillStyle=t.valueOrDefault(l.color?l.color.unchanged:void 0,n.elements.candlestick.color.unchanged)),e.lineWidth=t.valueOrDefault(l.borderWidth,n.elements.candlestick.borderWidth),e.strokeStyle=t.valueOrDefault(c,n.elements.candlestick.borderColor),e.beginPath(),e.moveTo(a,r),e.lineTo(a,Math.min(o,s)),e.moveTo(a,i),e.lineTo(a,Math.max(o,s)),e.stroke(),e.fillRect(a-l.width/2,s,l.width,o-s),e.strokeRect(a-l.width/2,s,l.width,o-s),e.closePath()}}r.id="candlestick",r.defaults=t.merge({},[n.elements.financial,{borderColor:n.elements.financial.color.unchanged,borderWidth:1}]);class i extends l{updateElements(e,t,l,a){const o=this,n=o.getDataset(),r=o._ruler||o._getRuler(),i=o.resolveDataElementOptions(t,a),s=o.getSharedOptions(i),c=o.includeOptions(a,s);o.updateSharedOptions(s,a,i);for(let i=t;i<l;i++){const t=s||o.resolveDataElementOptions(i,a),l={...o.calculateElementProperties(i,r,"reset"===a,t),datasetLabel:n.label||"",color:n.color,borderColor:n.borderColor,borderWidth:n.borderWidth};c&&(l.options=t),o.updateElement(e[i],i,l,a)}}}i.id="candlestick",i.defaults=t.merge({dataElementType:r.id},e.Chart.defaults.financial);const s=e.Chart.defaults;class c extends o{draw(e){const l=this,{x:a,open:o,high:n,low:r,close:i}=l,c=t.valueOrDefault(l.armLengthRatio,s.elements.ohlc.armLengthRatio);let d=t.valueOrDefault(l.armLength,s.elements.ohlc.armLength);null===d&&(d=l.width*c*.5),e.strokeStyle=i<o?t.valueOrDefault(l.color?l.color.up:void 0,s.elements.ohlc.color.up):i>o?t.valueOrDefault(l.color?l.color.down:void 0,s.elements.ohlc.color.down):t.valueOrDefault(l.color?l.color.unchanged:void 0,s.elements.ohlc.color.unchanged),e.lineWidth=t.valueOrDefault(l.lineWidth,s.elements.ohlc.lineWidth),e.beginPath(),e.moveTo(a,n),e.lineTo(a,r),e.moveTo(a-d,o),e.lineTo(a,o),e.moveTo(a+d,i),e.lineTo(a,i),e.stroke()}}c.id="ohlc",c.defaults=t.merge({},[s.elements.financial,{lineWidth:2,armLength:null,armLengthRatio:.8}]);class d extends l{updateElements(e,t,l,a){const o=this,n=o.getDataset(),r=o._ruler||o._getRuler(),i=o.resolveDataElementOptions(t,a),s=o.getSharedOptions(i),c=o.includeOptions(a,s);for(let t=0;t<l;t++){const l=s||o.resolveDataElementOptions(t,a),i={...o.calculateElementProperties(t,r,"reset"===a,l),datasetLabel:n.label||"",lineWidth:n.lineWidth,armLength:n.armLength,armLengthRatio:n.armLengthRatio,color:n.color};c&&(i.options=l),o.updateElement(e[t],t,i,a)}}}d.id="ohlc",d.defaults=t.merge({dataElementType:c.id,datasets:{barPercentage:1,categoryPercentage:1}},e.Chart.defaults.financial),e.Chart.register(i,d,r,c)}));
